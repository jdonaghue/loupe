<!DOCTYPE html>
<html>
	<head>
		<title>Bullet Chart</title>
		<script src="../../Peppy/peppy.js"></script>
		<script src="../loupe.js"></script>
		<script>
			window.onload = function() {

				function drawBulletChart() {

					var data = [{ title: 'Jobs Rate', subtitle: 'USD millions', value: 1.75 }, 
								{ title: 'Economy', subtitle: 'USD Trillions', value: 2.33 }, 
								{ title: 'Basketball', subtitle: 'Points', value: 3.48 }, 
								{ title: 'Shoes', subtitle: 'Size', value: 4 }, 
								{ title: 'Flights', subtitle: 'Landings', value: .7 }],
						opts = { reader: function(a) { return a } },
						div = peppy.query('div');

					// draw grey bars
					var greybars = loupe(div)
						.rect({
							x: 100,
							y: 30,
							width: 440,
							height: 24,
							color: '#eee'
						})
						.data(data, opts)
						.transform('linear', {
							y: function(val, data, index) { return 20 + (index * 40); }
						})
						.draw();

					// draw middle grey 
					var middlegrey = loupe(div)
						.rect({
							x: 100, 
							y: 30,
							width: 110,
							height: 24,
							color: '#ddd'
						})
						.data(data, opts)
						.transform('linear', {
							y: function(val, data, index) { return 20 + (index * 40); },
							width: null
						})
						.draw();

					// draw dark grey 
					var darkgrey = loupe(div)
						.rect({
							x: 100, 
							y: 30,
							width: 50,
							height: 24,
							color: '#bbb'
						})
						.data(data, opts)
						.transform('linear', {
							y: function(val, data, index) { return 20 + (index * 40); },
							width: null
						})
						.draw();

					// draw lightblue bars
					var lightbluebars = loupe(div)
						.rect({
							x: 100,
							y: 40,
							width: 105,
							height: 10,
							color: '#b0c4de'
						})
						.data(data, opts)
						.transform('linear', {
							y: function(val, data, index) { return 27 + (index * 40); }, 
							width: null
						})
						.draw();

					// draw blue bars
					var bluebars = loupe(div)
						.rect({
							x: 100,
							y: 40,
							width: 100,
							height: 10,
							color: '#4682b4'
						})
						.data(data, opts)
						.transform('linear', {
							y: function(val, data, index) { return 27 + (index * 40); }, 
							width: null
						})
						.draw();

					// draw ticks
					for (var i=0; i<5; i++) {
						for (var j=0; j<7; j++) {
							loupe(div)
								.line({
									x1: (j * 70) + 105,
									y1: ((i * 40) + 44),
									x2: (j * 70) + 105,
									y2: ((i * 40) + 47),
									stroke: 1,
									strokeColor: 'black'
								})
								.text({
									position: ( j ==0 ? 102 : ((j * 70) + 100)) + ',' + ((i * 40) + 55),
									class: 'tick',
									content: j * 10 + ''
								})
								.draw();
						}	
					}

					// draw labels
					for (var k=0,len=data.length; k<len; k++) {
						loupe(div)
							.text({
								position: '95, ' + (((k + 1) * 30) + (k * 10)),
								style: 'text-anchor: end;',
								class: 'title',
								content: data[k].title
							})
							.text({
								position: '95, ' + (((k + 1) * 30) + (k * 10) + 10),
								style: 'text-anchor: end;',
								class: 'subtitle',
								content: data[k].subtitle
							})
							.draw();
					}
				}

				drawBulletChart();

				var button = peppy.query('button')[0];
				button.addEventListener('click', drawBulletChart, false);
			}
		</script>

		<style type="text/css">
			body {
				font-family: "Helvetica Neue", Helvetica, sans-serif;
				padding-left: 70px;
			}

			h1 {
				font-size: 65px;
			}

			.container {
				width: 600px;
				height: 255px;
				border: 1px solid #ccc;
			}

			.title {
				font-size: 12px;
				font-weight: bold;
			}

			.subtitle {
				font-size: 8px;
				fill: #999;
			}

			.tick {
				font-size: 8px;
			}

			button {
				margin-left: 5px;
				margin-top: 5px;
			}
		</style>
	</head>
	<body>
		<h1>Bullet Chart</h1>
		<div class="container">
			<button>update</button>
		</div>
	</body>
</html>